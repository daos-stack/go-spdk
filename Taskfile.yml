version: '2'

tasks:
  main-task:
    cmds:
      - task: build-c-libs
      - task: unit-tests
      - task: build-go

  build-c-libs:
    dir: spdk
    cmds:
      - rm -f nvme_discover.o nvme_discover.so
      - gcc -c -fpic -Iinclude src/nvme_discover.c -lspdk
      - gcc -shared -o libnvme_discover.so nvme_discover.o

  unit-tests:
    dir: spdk
    cmds:
      - go test

  build-go:
    dir: spdk
    deps: [lint]
    cmds:
      - go build -v -i spdk.go

  lint:
    cmds:
      - gofmt -l -s -w . && go tool vet -all . && golint
